<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenCredit Platform</title>
    
    <!-- This script adds the styling (Tailwind CSS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- These scripts add React, which makes the page interactive -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- This script allows the browser to understand the special code format (JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Hide number input arrows for a cleaner look */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }

        /* --- Custom Slider Styles for a smoother feel --- */
        input[type=range] {
            -webkit-appearance: none; /* Hides the default slider appearance in WebKit browsers */
            appearance: none;
            width: 100%; 
            height: 6px; /* A slightly thinner track */
            background: #e2e8f0; /* Tailwind's gray-200 for the track */
            border-radius: 9999px; /* Fully rounded track */
            outline: none; /* Removes the outline on focus */
        }

        /* --- Slider Thumb Styling for WebKit (Chrome, Safari) --- */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; /* Override default look */
            appearance: none;
            width: 18px; /* Thumb width */
            height: 18px; /* Thumb height */
            background: #3b82f6; /* Tailwind's blue-500 for the thumb */
            border-radius: 50%; /* Circular thumb */
            cursor: pointer; /* Pointer cursor on hover */
            border: 2px solid white; /* White border for contrast */
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); /* Subtle shadow */
            transition: transform 0.15s ease-in-out; /* Smooth transition for scaling */
        }

        /* --- Enlarge thumb on click/drag for a responsive feel --- */
        input[type=range]:active::-webkit-slider-thumb {
            transform: scale(1.25); 
        }

        /* --- Slider Thumb Styling for Firefox --- */
        input[type=range]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.15s ease-in-out;
        }
        
        /* --- Enlarge thumb on click/drag for Firefox --- */
        input[type=range]:active::-moz-range-thumb {
            transform: scale(1.25);
        }

    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50">

    <!-- The React application will be placed inside this div -->
    <div id="root"></div>

    <!-- This is the entire application code -->
    <script type="text/babel">
    
        // --- Mock UI Components (for demonstration purposes) ---
        const Card = ({ children, className = '' }) => <div className={`bg-white border border-gray-200 rounded-lg shadow-sm ${className}`}>{children}</div>;
        const CardHeader = ({ children, className = '' }) => <div className={`p-4 border-b border-gray-200 ${className}`}>{children}</div>;
        const CardContent = ({ children, className = '' }) => <div className={`p-4 ${className}`}>{children}</div>;
        
        // --- Mock Lucide Icons (using inline SVG for demonstration) ---
        const Icon = ({ children, className = 'w-6 h-6' }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>;
        const TrendingUp = ({ className }) => <Icon className={className}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></Icon>;
        const User = ({ className }) => <Icon className={className}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></Icon>;
        const CreditCard = ({ className }) => <Icon className={className}><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></Icon>;
        const DollarSign = ({ className }) => <Icon className={className}><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></Icon>;
        const Calculator = ({ className }) => <Icon className={className}><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="18"></line><line x1="8" y1="10" x2="8" y2="18"></line><line x1="12" y1="10" x2="12" y2="18"></line></Icon>;
        const Users = ({ className }) => <Icon className={className}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></Icon>;
        const Building = ({ className }) => <Icon className={className}><rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect><line x1="9" y1="9" x2="15" y2="9"></line><line x1="9" y1="13" x2="15" y2="13"></line><line x1="9" y1="17" x2="15" y2="17"></line></Icon>;
        const Shield = ({ className }) => <Icon className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></Icon>;
        const AlertTriangle = ({ className }) => <Icon className={className}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></Icon>;
        const Globe = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></Icon>;
        const BookOpen = ({ className }) => <Icon className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></Icon>;
        const Info = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></Icon>;
        const FileText = ({ className }) => <Icon className={className}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></Icon>;
        const ShoppingCart = ({ className }) => <Icon className={className}><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></Icon>;
        const GraduationCap = ({ className }) => <Icon className={className}><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></Icon>;
        const Shirt = ({ className }) => <Icon className={className}><path d="M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"></path></Icon>;
        const Activity = ({ className }) => <Icon className={className}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></Icon>;
        const Car = ({ className }) => <Icon className={className}><path d="M14 16.5V18a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-1.5m2-13L8 7m6 0-6 6.5"></path><path d="M14 5h5a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-5m-4 0H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h5"></path></Icon>;
        const HeartPulse = ({ className }) => <Icon className={className}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path><path d="M3.22 12H9.5l.7-1 2.1 4.2 1.6-3 1.4 2.8"></path></Icon>;
        const PiggyBank = ({ className }) => <Icon className={className}><path d="M10 17V8.5c0-1.66 1.34-3 3-3h1.5c1.38 0 2.5 1.12 2.5 2.5S15.88 10.5 14.5 10.5H13"></path><path d="M10 17c-1.66 0-3 1.34-3 3h12c0-1.66-1.34-3-3-3h-6z"></path><path d="M12 8.5c0-1.93 1.57-3.5 3.5-3.5s3.5 1.57 3.5 3.5"></path><path d="M12 13.5V17"></path><path d="M16 13.5V17"></path></Icon>;
        const Target = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></Icon>;
        const Bank = ({ className }) => <Icon className={className}><path d="M3 22h18"></path><path d="M6 18V9.52c0-1.3.8-2.47 2-2.88l4-1.6c.7-.28 1.3-.28 2 0l4 1.6c1.2.41 2 1.58 2 2.88V18"></path><path d="M6 18h12"></path><path d="M12 18V9"></path></Icon>;
        const Briefcase = ({ className }) => <Icon className={className}><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></Icon>;
        const Zap = ({ className }) => <Icon className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></Icon>;

        const BellCurveChart = ({ userScore }) => {
            const distribution = [5, 8, 15, 22, 25, 15, 8, 2];
            const labels = ['<45', '45-55', '55-65', '65-75', '75-85', '85-95', '95-100', '>100'];
            const getBucketIndex = (score) => {
                if (score < 45) return 0; if (score < 55) return 1; if (score < 65) return 2; if (score < 75) return 3; if (score < 85) return 4; if (score < 95) return 5; if (score <= 100) return 6; return 7;
            };
            const userBucketIndex = getBucketIndex(userScore);
            return (
                <div>
                    <div className="flex items-end justify-center h-48 space-x-1 p-4">
                        {distribution.map((height, index) => (
                            <div key={index} className="flex-1 flex flex-col items-center justify-end">
                                <div className={`w-full rounded-t-md transition-all duration-500 ${index === userBucketIndex ? 'bg-blue-600' : 'bg-gray-300'}`} style={{ height: `${height * 3.5}px` }}></div>
                                <div className={`text-xs mt-1 font-medium ${index === userBucketIndex ? 'text-blue-600' : 'text-gray-500'}`}>{labels[index]}</div>
                            </div>
                        ))}
                    </div>
                    <div className="text-center text-sm text-gray-600 mt-2">Your Score: <span className="font-bold text-blue-600">{userScore}</span></div>
                </div>
            );
        };

        const PerspectiveToggle = ({ perspective, setPerspective }) => {
            return (
                <div className="flex justify-center items-center space-x-2 bg-gray-200 p-1 rounded-full">
                    <button onClick={() => setPerspective('borrower')} className={`px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 flex items-center gap-2 ${perspective === 'borrower' ? 'bg-white text-blue-600 shadow' : 'text-gray-600'}`}>
                        <User className="w-4 h-4" /> Borrower View
                    </button>
                    <button onClick={() => setPerspective('lender')} className={`px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 flex items-center gap-2 ${perspective === 'lender' ? 'bg-white text-blue-600 shadow' : 'text-gray-600'}`}>
                        <Briefcase className="w-4 h-4" /> Lender View
                    </button>
                </div>
            );
        };

        const ScoreGuide = () => {
            const scoreData = [
                { platform: '85-100', category: 'Excellent', fico: '780-850', cibil: '800+', schufa: '97.5%+' },
                { platform: '75-84', category: 'Very Good', fico: '720-779', cibil: '750-799', schufa: '95%-97.5%' },
                { platform: '65-74', category: 'Good', fico: '680-719', cibil: '700-749', schufa: '90%-95%' },
                { platform: '55-64', category: 'Fair', fico: '620-679', cibil: '650-699', schufa: '80%-90%' },
                { platform: '< 55', category: 'Poor', fico: '< 620', cibil: '< 650', schufa: '< 80%' },
            ];
            const terms = {
                "Probability of Default (PD)": "The statistical likelihood that a borrower will be unable to make their payments over the next year.",
                "Loss Given Default (LGD)": "If a borrower defaults, this is the percentage of the outstanding loan that the lender expects to lose.",
                "Expected Loss (EL)": "The average financial loss a lender can expect from a loan over a period of time, calculated as PD x LGD."
            };

            return (
                <Card>
                    <CardHeader><h3 className="text-lg font-semibold text-gray-800">Understanding Your Score</h3></CardHeader>
                    <CardContent>
                        <p className="text-sm text-gray-600 mb-4">This score is an educational estimate. Below is a conceptual guide to how it might compare to official scores from major credit bureaus. This is not a direct conversion.</p>
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm text-left">
                                <thead className="bg-gray-100">
                                    <tr>
                                        <th className="p-2 font-semibold">Platform Score</th>
                                        <th className="p-2 font-semibold">Category</th>
                                        <th className="p-2 font-semibold">US FICO (Approx.)</th>
                                        <th className="p-2 font-semibold">India CIBIL (Approx.)</th>
                                        <th className="p-2 font-semibold">Germany SCHUFA (Approx.)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {scoreData.map((row, i) => (
                                        <tr key={i} className="border-b">
                                            <td className="p-2 font-medium text-blue-600">{row.platform}</td>
                                            <td className="p-2">{row.category}</td>
                                            <td className="p-2">{row.fico}</td>
                                            <td className="p-2">{row.cibil}</td>
                                            <td className="p-2">{row.schufa}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        <h4 className="text-md font-semibold text-gray-800 mt-6 mb-2">Key Financial Terms</h4>
                        <div className="space-y-2">
                            {Object.entries(terms).map(([term, def]) => (
                                <div key={term} className="text-sm">
                                    <strong className="text-gray-700">{term}:</strong>
                                    <span className="text-gray-600 ml-1">{def}</span>
                                </div>
                            ))}
                        </div>
                    </CardContent>
                </Card>
            );
        };
        
        const LoanScenarios = ({ results, inputs, currencyConfig, currency, formatCurrency }) => {
            const { overallRiskScore, debtToIncomeRatio } = results;
            const pppAdjustedIncome = Math.max(inputs.individualIncome, inputs.familyIncome) * currencyConfig[currency].ppp_adjustment;
            const monthlyIncome = pppAdjustedIncome / 12;
            const existingMonthlyDebt = (inputs.securedDebt + inputs.unsecuredDebt) / 12 * 0.05; // Simplified estimate

            const unsecuredLimit = results.recommendedLimit;
            const vehicleLoanMultiplier = 1.5; 
            const vehicleLoanAmount = unsecuredLimit * vehicleLoanMultiplier;

            const maxDTIForMortgage = 43;
            const maxMonthlyDebtPayment = monthlyIncome * (maxDTIForMortgage / 100);
            const availableForMortgage = maxMonthlyDebtPayment - existingMonthlyDebt;
            
            let mortgageAmount = 0;
            if (availableForMortgage > 0) {
                const r = 0.04 / 12;
                const n = 30 * 12;
                mortgageAmount = availableForMortgage * ( (Math.pow(1+r, n) - 1) / (r * Math.pow(1+r, n)) );
            }

            const canConsolidate = inputs.unsecuredDebt > 0 && unsecuredLimit > inputs.unsecuredDebt;

            return (
                <Card>
                    <CardHeader><h3 className="text-lg font-semibold text-gray-800">Potential Borrowing Scenarios</h3></CardHeader>
                    <CardContent className="space-y-4">
                        <p className="text-sm text-gray-600">Based on your profile, here are some estimated scenarios. These are for illustrative purposes only and are not a guarantee of credit.</p>
                        
                        <div className="p-3 bg-gray-50 rounded-lg border">
                            <h4 className="font-semibold text-gray-800">Unsecured Personal Loan</h4>
                            <p className="text-sm text-gray-600">For things like home improvements or unexpected expenses, you might be approved for a limit around <strong className="text-blue-600">{formatCurrency(unsecuredLimit)}</strong>.</p>
                        </div>

                        <div className="p-3 bg-gray-50 rounded-lg border">
                            <h4 className="font-semibold text-gray-800">Vehicle Loan (Secured)</h4>
                            <p className="text-sm text-gray-600">Because a vehicle loan is secured by the car itself, lenders may offer a higher limit, potentially up to <strong className="text-blue-600">{formatCurrency(vehicleLoanAmount)}</strong>, depending on the vehicle's value.</p>
                        </div>
                        
                        <div className="p-3 bg-gray-50 rounded-lg border">
                            <h4 className="font-semibold text-gray-800">Mortgage Pre-Assessment</h4>
                            {mortgageAmount > 0 ? (
                                <p className="text-sm text-gray-600">To stay within a standard 43% Debt-to-Income ratio, your profile could potentially support a mortgage of around <strong className="text-blue-600">{formatCurrency(mortgageAmount)}</strong>. This is highly dependent on your down payment and the lender's specific requirements.</p>
                            ) : (
                                <p className="text-sm text-gray-600">Your current debt-to-income ratio is likely too high to qualify for a significant mortgage. Focusing on paying down existing debt would be the first step.</p>
                            )}
                        </div>

                        {canConsolidate && (
                             <div className="p-3 bg-green-50 rounded-lg border border-green-200">
                                <h4 className="font-semibold text-green-800">Opportunity: Debt Consolidation</h4>
                                <p className="text-sm text-green-700">Your recommended unsecured limit of <strong className="text-green-900">{formatCurrency(unsecuredLimit)}</strong> appears sufficient to consolidate your existing <strong className="text-green-900">{formatCurrency(inputs.unsecuredDebt)}</strong> of unsecured debt. This could simplify your payments and potentially lower your interest rate.</p>
                            </div>
                        )}

                    </CardContent>
                </Card>
            );
        };

        const ModelAssumptions = () => (
            <Card>
                <CardHeader><h3 className="text-lg font-semibold text-gray-800">Model Assumptions & Limitations</h3></CardHeader>
                <CardContent className="space-y-3 text-sm text-gray-700">
                    <p>This model is built on a foundation of established financial principles, but it operates on several key assumptions and has inherent limitations:</p>
                    <ul className="list-disc pl-5 space-y-2">
                        <li><strong>Statistical Validation:</strong> The primary limitation is that this model has not been statistically validated (backtested) against a large, real-world dataset of loan outcomes. Its logic is sound, but its predictive accuracy is not proven.</li>
                        <li><strong>Static & Deterministic:</strong> The model provides a snapshot based on current inputs. It does not account for dynamic macroeconomic factors like inflation, unemployment rates, or sudden market shocks (e.g., "Black Swan" events or contagion effects).</li>
                        <li><strong>Linear Relationships:</strong> The model assumes mostly linear relationships between factors and risk. In reality, these relationships can be far more complex.</li>
                        <li><strong>Data Honesty:</strong> The accuracy of the output is entirely dependent on the accuracy and honesty of the inputs provided by the user.</li>
                        <li><strong>Simplified Logic:</strong> This is a simplified, educational model. Production-grade models used by banks are vastly more complex, incorporating hundreds of variables and machine learning techniques.</li>
                    </ul>
                </CardContent>
            </Card>
        );

        const DetailedCalculationStep = ({ data }) => {
            if (!data) return null;
            return (
                <div className="p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <h4 className="font-semibold text-blue-800">{data.title}</h4>
                    <p className="text-xs text-gray-600 mt-1 mb-2">{data.explanation}</p>
                    
                    {data.subSteps && data.subSteps.map((step, index) => (
                        <div key={index} className="mt-2 p-3 bg-white rounded-md border text-xs space-y-1">
                            <p className="font-semibold text-gray-700">{step.title}</p>
                            {step.explanation && <p className="text-gray-500 italic">{step.explanation}</p>}
                            <p><strong className="font-mono text-gray-500">Formula:</strong> <span className="font-mono text-purple-700">{step.formula}</span></p>
                            <p><strong className="font-mono text-gray-500">Calculation:</strong> <span className="font-mono text-purple-700">{step.calculation}</span></p>
                            <p><strong className="font-mono text-gray-500">Result:</strong> <span className="font-mono text-purple-700 font-bold">{step.result}</span></p>
                        </div>
                    ))}

                    <div className="mt-3 text-sm space-y-1 bg-blue-50 p-2 rounded border border-blue-200">
                        <p><strong className="font-mono text-gray-500">Final Formula:</strong> <span className="font-mono text-blue-700">{data.formula}</span></p>
                        <p><strong className="font-mono text-gray-500">Final Calculation:</strong> <span className="font-mono text-blue-700">{data.calculation}</span></p>
                        <p><strong className="font-mono text-gray-500">Final Result:</strong> <span className="font-mono text-blue-700 font-bold">{data.result}</span></p>
                    </div>
                    {data.rationale && <div className="mt-2 p-2 bg-blue-50 border-l-4 border-blue-300 text-xs text-blue-900"><strong>Rationale:</strong> {data.rationale}</div>}
                </div>
            );
        };

        const AdvancedMetricsStep = ({ data }) => (<div className="p-4 bg-gray-50 rounded-lg border border-gray-200"><h4 className="font-semibold text-blue-800">{data.title}</h4><p className="text-xs text-gray-600 mt-1 mb-2">{data.explanation}</p><div className="space-y-2">{data.metrics.map(metric => (<div key={metric.name} className="text-xs bg-white p-2 rounded border"><div className="flex justify-between items-center"><strong className="text-gray-800">{metric.name}:</strong><span className="font-mono text-purple-700 font-bold">{metric.value}</span></div><p className="text-gray-500 mt-1">{metric.description}</p><p className="font-mono text-xs text-gray-400">({metric.formula})</p></div>))}</div></div>);

        function App() {
          const { useState, useEffect } = React;
          const [perspective, setPerspective] = useState('borrower');
          const [currency, setCurrency] = useState('EUR');
          const [activeTab, setActiveTab] = useState('financial');
          const [hasCalculated, setHasCalculated] = useState(false);
          
          const getScoreEquivalent = (score) => {
              if (score >= 85) return { fico: '780-850', cibil: '800+', schufa: '97.5%+' };
              if (score >= 75) return { fico: '720-779', cibil: '750-799', schufa: '95%-97.5%' };
              if (score >= 65) return { fico: '680-719', cibil: '700-749', schufa: '90%-95%' };
              if (score >= 55) return { fico: '620-679', cibil: '650-699', schufa: '80%-90%' };
              return { fico: '< 620', cibil: '< 650', schufa: '< 80%' };
          };

          const currencyConfig = {
            USD: { symbol: '$', name: 'US Dollar', country: 'USA', ppp_adjustment: 1.0, country_risk: 0.5, score_equiv_label: 'FICO Equivalent', get_score: (s) => getScoreEquivalent(s).fico },
            EUR: { symbol: '€', name: 'Euro', country: 'Germany', ppp_adjustment: 0.82, country_risk: 0.8, score_equiv_label: 'SCHUFA Equivalent', get_score: (s) => getScoreEquivalent(s).schufa },
            INR: { symbol: '₹', name: 'Indian Rupee', country: 'India', ppp_adjustment: 0.28, country_risk: 3.2, score_equiv_label: 'CIBIL Equivalent', get_score: (s) => getScoreEquivalent(s).cibil }
          };

          const [inputs, setInputs] = useState({
            individualIncome: 60000, familyIncome: 90000, securedDebt: 25000, unsecuredDebt: 8000, bankSavings: 15000, equityInvestments: 20000, realEstate: 200000, bullionAssets: 5000, cryptoAssets: 10000, employmentTenure: 36, creditCardPayments: 95, loanPayments: 88, rentPayments: 98, governmentPayments: 95, utilityPayments: 98, age: 35, numberOfChildren: 1, marriedStatus: 1, educationLevel: 3, restaurantSpending: 400, vacationSpending: 3000, sinSpending: 50, groceriesSpending: 400, kidsEducationSpending: 200, clothingSpending: 150, kidsActivitiesSpending: 100, carMaintenance: 150, lifeInsurance: 100, medicalInsurance: 300, medicalBills: 50, donations: 20, otherExpenses: 100, avgMonthlyIncome: 5000, avgMonthEndBalance: 2500, budgetingTool: 2, financialGoals: { retirement: true, emergencyFund: true, downPayment: false, payOffDebt: true, travel: false }, requestedLimit: 10000, residencyStatus: 0, subscriptionServices: 120
          });

          const [results, setResults] = useState({
            overallRiskScore: 0, riskCategory: '', riskGrade: '', recommendedLimit: 0, expectedLoss: 0, defaultProbability: 0, recommendations: [], warningFlags: [], debtToIncomeRatio: 0, leverageRatio: 0
          });
          
          const [calculationBreakdown, setCalculationBreakdown] = useState(null);
          const [improvementReport, setImprovementReport] = useState("");

          const formatCurrency = (amount) => currencyConfig[currency].symbol + Math.round(amount).toLocaleString();
          const formatNumber = (num, places = 2) => parseFloat(num.toFixed(places));

          const calculateAdvancedRisk = () => {
            const config = currencyConfig[currency];
            const formatCurrencyLocal = (amount) => config.symbol + Math.round(amount).toLocaleString();
            
            const breakdown = {};
            const pppAdjustedIncome = Math.max(inputs.individualIncome, inputs.familyIncome) * config.ppp_adjustment;
            const riskAdjustedCrypto = inputs.cryptoAssets * 0.50;
            const riskAdjustedBullion = inputs.bullionAssets * 0.90;
            const totalAssets = inputs.bankSavings + inputs.equityInvestments + inputs.realEstate + riskAdjustedBullion + riskAdjustedCrypto;
            const totalDebt = inputs.securedDebt + inputs.unsecuredDebt;
            
            // --- Component 1: Payment History ---
            const paymentHistoryScore = (inputs.creditCardPayments * 0.30) + (inputs.loanPayments * 0.25) + (inputs.rentPayments * 0.20) + (inputs.utilityPayments * 0.15) + (inputs.governmentPayments * 0.10);
            breakdown.paymentHistory = { 
                title: "Component 1: Payment History (40% Weight)", 
                explanation: "This is the most critical factor. It reflects your reliability in meeting past obligations.", 
                formula: "Weighted average of on-time payments.", 
                calculation: `(${inputs.creditCardPayments}*0.30) + (${inputs.loanPayments}*0.25) + (${inputs.rentPayments}*0.20) + (${inputs.utilityPayments}*0.15) + (${inputs.governmentPayments}*0.10)`,
                result: `Score: ${formatNumber(paymentHistoryScore)} / 100`, 
                rationale: "Weights are aligned with industry models like FICO, where timely payments on traditional credit (cards, loans) are most predictive." 
            };

            // --- Component 2: Financial Health ---
            const debtToIncomeRatio = pppAdjustedIncome > 0 ? (totalDebt / pppAdjustedIncome) * 100 : Infinity;
            const dtiScore = Math.max(0, 100 - (debtToIncomeRatio * 1.2));
            const leverageRatio = totalAssets > 0 ? (totalDebt / totalAssets) * 100 : 0;
            const leverageScore = Math.max(0, 100 - leverageRatio);
            const liquidityRatio = pppAdjustedIncome > 0 ? inputs.bankSavings / (pppAdjustedIncome / 12) : 0;
            const liquidityScore = Math.min(100, liquidityRatio * 15);
            const financialHealthScore = (dtiScore * 0.40) + (leverageScore * 0.35) + (liquidityScore * 0.25);
            breakdown.financialHealth = { 
                title: "Component 2: Financial Health (30% Weight)", 
                explanation: "Measures your current financial stability and capacity to handle debt.",
                formula: "(DTI Score × 0.40) + (Leverage Score × 0.35) + (Liquidity Score × 0.25)",
                calculation: `(${formatNumber(dtiScore)}*0.40) + (${formatNumber(leverageScore)}*0.35) + (${formatNumber(liquidityScore)}*0.25)`,
                result: `Score: ${formatNumber(financialHealthScore)} / 100`,
                subSteps: [
                    { title: "DTI Score", explanation: "The * 1.2 is a sensitivity factor to penalize high DTI more heavily.", formula: "max(0, 100 - (DTI_Ratio * 1.2))", calculation: `max(0, 100 - (${formatNumber(debtToIncomeRatio)} * 1.2))`, result: formatNumber(dtiScore) },
                    { title: "Leverage Score", formula: "max(0, 100 - Leverage_Ratio)", calculation: `max(0, 100 - ${formatNumber(leverageRatio)})`, result: formatNumber(leverageScore) },
                    { title: "Liquidity Score", explanation: "The * 15 is a scaling factor to convert 'months of savings' to a score out of 100.", formula: "min(100, Months_of_Savings * 15)", calculation: `min(100, ${formatNumber(liquidityRatio)} * 15)`, result: formatNumber(liquidityScore) }
                ],
                rationale: "This category mirrors FICO's 'Amounts Owed'. DTI is the most critical indicator of cash flow strain. Leverage shows overall reliance on debt."
            };

            // --- Component 3: Behavioral & Stability ---
            const emergencyMonths = pppAdjustedIncome > 0 ? inputs.bankSavings / (pppAdjustedIncome / 12) : 0;
            const emergencyFundScore = (100 - (Math.max(0, 5 - emergencyMonths) * 20));
            const cashFlowStabilityScore = inputs.avgMonthlyIncome > 0 ? Math.min(100, (inputs.avgMonthEndBalance / inputs.avgMonthlyIncome) * 150) : 0;
            const budgetingScore = inputs.budgetingTool * 25;
            const goalsScore = Object.values(inputs.financialGoals).filter(Boolean).length * 20;
            const behavioralScore = (emergencyFundScore * 0.30) + (cashFlowStabilityScore * 0.30) + (budgetingScore * 0.20) + (goalsScore * 0.20);
            
            const residencyRiskPenalties = [0, 5, 15, 20];
            const residencyRisk = residencyRiskPenalties[inputs.residencyStatus];
            const residencyScore = 100 - residencyRisk;
            const employmentScore = Math.min(100, (inputs.employmentTenure / 60) * 100);
            const demographicScore = (residencyScore * 0.50) + (employmentScore * 0.50);
            
            const combinedBehavioralScore = (behavioralScore * 0.5) + (demographicScore * 0.5);
            breakdown.behavioral = { 
                title: "Component 3: Behavioral & Stability (30% Weight)", 
                explanation: "A proxy for financial habits and life stability.",
                formula: "(Behavioral Score × 0.5) + (Stability Score × 0.5)",
                calculation: `(${formatNumber(behavioralScore)}*0.5) + (${formatNumber(demographicScore)}*0.5)`,
                result: `Score: ${formatNumber(combinedBehavioralScore)} / 100`,
                subSteps: [
                    { title: "Behavioral Habits Score", formula: "Weighted Avg(Emergency Fund, Cash Flow, Budgeting, Goals)", calculation: `(${formatNumber(emergencyFundScore)}*0.3) + (${formatNumber(cashFlowStabilityScore)}*0.3) + (${budgetingScore}*0.2) + (${goalsScore}*0.2)`, result: formatNumber(behavioralScore) },
                    { title: "Demographic Stability Score", formula: "(Residency Score * 0.5) + (Employment Score * 0.5)", calculation: `(${formatNumber(residencyScore)}*0.5) + (${formatNumber(employmentScore)}*0.5)`, result: formatNumber(demographicScore) }
                ],
                rationale: "Proactive financial habits and life stability are strong indicators of future reliability."
            };
            
            // --- Final Score ---
            const baseRiskScore = (paymentHistoryScore * 0.40) + (financialHealthScore * 0.30) + (combinedBehavioralScore * 0.30);
            const countryRiskMultiplier = 1 + (config.country_risk / 100);
            const countryAdjustedScore = baseRiskScore / countryRiskMultiplier;
            breakdown.finalScore = { 
                title: "Final Score Calculation", 
                explanation: "The three main component scores are combined and then adjusted for country-specific risk.", 
                formula: "((Payment * 0.4) + (Health * 0.3) + (Behavioral * 0.3)) / Country_Risk",
                calculation: `((${formatNumber(paymentHistoryScore)}*0.4) + (${formatNumber(financialHealthScore)}*0.3) + (${formatNumber(combinedBehavioralScore)}*0.3)) / ${countryRiskMultiplier}`,
                result: `Final Score: ${formatNumber(countryAdjustedScore)} / 100`
            };

            const probabilityOfDefault = Math.max(0.1, 50 - (countryAdjustedScore * 0.5)) / 100;
            const lossGivenDefault = 0.45 + ((100-behavioralScore) / 1000);
            const exposureAtDefault = inputs.requestedLimit * (1 + ((100-behavioralScore) / 500));
            const expectedLoss = probabilityOfDefault * lossGivenDefault * exposureAtDefault;
            breakdown.advancedMetrics = { title: "Advanced Risk Metrics (Basel III aligned)", explanation: "Translates the score into financial impact.", metrics: [ { name: "Probability of Default (PD)", value: `${formatNumber(probabilityOfDefault * 100, 2)}%`, formula: "Based on final score", description: "Likelihood of default within one year." }, { name: "Loss Given Default (LGD)", value: `${formatNumber(lossGivenDefault * 100, 1)}%`, formula: "45% base + behavioral adjustment", description: "Loss if default occurs." }, { name: "Exposure at Default (EAD)", value: formatCurrencyLocal(exposureAtDefault), formula: "Limit + potential increase", description: "Total exposure at default." }, { name: "Expected Loss (EL)", value: formatCurrencyLocal(expectedLoss), formula: "PD × LGD × EAD", description: "Statistically expected loss." } ] };
            setCalculationBreakdown(breakdown);

            let riskCategory, riskGrade;
            if (countryAdjustedScore >= 85) { riskCategory = 'Excellent'; riskGrade = 'AAA'; } else if (countryAdjustedScore >= 75) { riskCategory = 'Very Good'; riskGrade = 'AA'; } else if (countryAdjustedScore >= 65) { riskCategory = 'Good'; riskGrade = 'A'; } else if (countryAdjustedScore >= 55) { riskCategory = 'Fair'; riskGrade = 'BBB'; } else if (countryAdjustedScore >= 45) { riskCategory = 'Poor'; riskGrade = 'BB'; } else { riskCategory = 'Very Poor'; riskGrade = 'B'; }

            const monthlyExpenses = (inputs.groceriesSpending || 0) + (inputs.kidsEducationSpending || 0) + (inputs.clothingSpending || 0) + (inputs.kidsActivitiesSpending || 0) + (inputs.carMaintenance || 0) + (inputs.lifeInsurance || 0) + (inputs.medicalInsurance || 0) + (inputs.restaurantSpending || 0) + (inputs.subscriptionServices || 0) + (inputs.sinSpending || 0) + (inputs.medicalBills || 0) + (inputs.donations || 0) + (inputs.otherExpenses || 0) + ((inputs.vacationSpending || 0) / 12);
            const emergencyFundTarget3Months = formatCurrencyLocal(monthlyExpenses * 3);
            const emergencyFundTarget6Months = formatCurrencyLocal(monthlyExpenses * 6);

            let report = `Based on your inputs, your risk profile is **'${riskCategory}'**.\n\nHere are personalized steps to improve your score:\n\n`;
            if (paymentHistoryScore < 95) report += `* **Perfect Your Payment History (Highest Impact).** This is 40% of your score. To avoid accidental late payments, log in to your online banking or your providers' websites (for credit cards, loans, utilities) and set up rules to automatically pay at least the minimum amount due each month from your bank account.\n`;
            if (debtToIncomeRatio > 36) report += `* **Reduce Debt-to-Income Ratio.** Your DTI of ${formatNumber(debtToIncomeRatio)}% is high. Focus on paying down high-interest unsecured debt. This is a major factor in the 'Financial Health' component.\n`;
            if (emergencyMonths < 3) report += `* **Build Your Emergency Fund.** You have ~${formatNumber(emergencyMonths, 1)} months of expenses saved. Based on your spending, you should aim for a fund between **${emergencyFundTarget3Months} and ${emergencyFundTarget6Months}** to cover 3-6 months of expenses.\n`;
            if (inputs.budgetingTool < 2) report += `* **Adopt Budgeting Tools.** Using a dedicated app (like Mint, YNAB, etc.) provides clear insights into your cash flow and is a positive signal of proactive financial management.\n`;
            if (report.split('*').length - 1 === 0) report += "* **Maintain Good Habits:** Your financial profile is strong. Continue your current practices to maintain your excellent score.\n";
            setImprovementReport(report);

            const recommendedLimit = Math.max(inputs.requestedLimit * 0.3, Math.min(inputs.requestedLimit, (pppAdjustedIncome * 0.25) * (countryAdjustedScore / 100)));
            const warningFlags = [];
            if (debtToIncomeRatio > 40) warningFlags.push("High DTI");
            if (paymentHistoryScore < 90) warningFlags.push("Missed Payments");
            if (emergencyMonths < 3) warningFlags.push("Low Emergency Fund");
            const recommendations = [];
            if (emergencyMonths < 3) recommendations.push(`Build emergency fund to ${emergencyFundTarget3Months} - ${emergencyFundTarget6Months}`);
            if (inputs.budgetingTool < 2) recommendations.push("Adopt digital budgeting tools");
            if (paymentHistoryScore < 95) recommendations.push("Set up automatic bill payments");
            setResults({ overallRiskScore: Math.round(countryAdjustedScore), riskCategory, riskGrade, recommendedLimit, expectedLoss, defaultProbability: formatNumber(probabilityOfDefault * 100), recommendations, warningFlags, debtToIncomeRatio: formatNumber(debtToIncomeRatio), leverageRatio: formatNumber(leverageRatio) });
          };
          
          const handleCalculateRisk = () => { calculateAdvancedRisk(); setHasCalculated(true); setActiveTab('results'); };
          
          const SliderInput = ({ label, value, onChange, min, max, step, icon: Icon, unit, isCurrency, helpText }) => {
              const [inputValue, setInputValue] = useState(value.toString());
              useEffect(() => { setInputValue(value.toLocaleString()); }, [value, currency]);
              const handleInputChange = (e) => { setInputValue(e.target.value); };
              const handleBlur = () => {
                  let numValue = parseInt(inputValue.replace(/[^0-9]/g, ''), 10);
                  if (isNaN(numValue)) numValue = min;
                  if (numValue > max) numValue = max;
                  if (numValue < min) numValue = min;
                  onChange(numValue);
              };
              const handleSliderChange = (e) => {
                  const newValue = parseInt(e.target.value, 10);
                  setInputValue(newValue.toLocaleString());
                  onChange(newValue);
              };
              return (
                  <div className="space-y-2">
                      <div className="flex items-center gap-2">
                          <Icon className="w-4 h-4 text-gray-600 flex-shrink-0" />
                          <label className="text-sm font-medium text-gray-800">{label}</label>
                          <div className="ml-auto flex items-center gap-1 border border-gray-300 rounded-md p-1 bg-gray-50">
                              {isCurrency && <span className="text-sm text-gray-600">{currencyConfig[currency].symbol}</span>}
                              <input type="text" inputMode="numeric" value={inputValue} onChange={handleInputChange} onBlur={handleBlur} onKeyDown={(e) => { if (e.key === 'Enter') e.target.blur() }} className="w-24 text-right bg-transparent text-sm font-mono focus:outline-none" />
                              {unit && <span className="text-sm text-gray-600">{unit}</span>}
                          </div>
                      </div>
                      <input type="range" min={min} max={max} step="1" value={value} onChange={handleSliderChange} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" />
                      {helpText && (<div className="text-xs text-gray-500 pt-1">{helpText}</div>)}
                  </div>
              );
          };

          const RadioGroup = ({ label, options, value, onChange, icon: Icon, helpText }) => (<div className="space-y-3"><div className="flex items-center gap-2"><Icon className="w-4 h-4 text-gray-600" /><label className="text-sm font-medium text-gray-800">{label}</label></div>{helpText && <p className="text-xs text-gray-500 pl-6">{helpText}</p>}<div className="grid grid-cols-1 gap-2 pl-6">{options.map((option, index) => (<label key={index} className="flex items-center space-x-2 cursor-pointer text-sm text-gray-700"><input type="radio" value={index} checked={value === index} onChange={() => onChange(index)} className="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500" /><span>{option}</span></label>))}</div></div>);
          const CheckboxGroup = ({ label, options, values, onChange, icon: Icon, helpText }) => (<div className="space-y-3"><div className="flex items-center gap-2"><Icon className="w-4 h-4 text-gray-600" /><label className="text-sm font-medium text-gray-800">{label}</label></div>{helpText && <p className="text-xs text-gray-500 pl-6">{helpText}</p>}<div className="grid grid-cols-1 sm:grid-cols-2 gap-2 pl-6">{Object.keys(options).map((key) => (<label key={key} className="flex items-center space-x-2 cursor-pointer text-sm text-gray-700"><input type="checkbox" checked={values[key]} onChange={() => onChange(key)} className="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500" /><span>{options[key]}</span></label>))}</div></div>);
          
          const inputTabs = ['financial', 'payment history', 'lifestyle', 'behavioral', 'demographics'];
          const resultTabs = ['results', 'model logic'];
          const displayedTabs = hasCalculated ? [...resultTabs, ...inputTabs] : inputTabs;

          return (
            <div className="max-w-7xl mx-auto p-4 sm:p-6 space-y-6 bg-gray-50 min-h-screen">
              <div className="text-center mb-8">
                <h1 className="text-3xl sm:text-4xl font-bold text-gray-900 mb-2"><a href="https://arnavray.ca" target="_blank" className="hover:text-blue-600 transition-colors">OpenCredit Platform</a></h1>
                <p className="text-gray-600 mb-4 max-w-2xl mx-auto">An open-source, research-based credit risk model with full transparency.</p>
                <div className="flex justify-center items-center gap-4 mb-6">
                    <select value={currency} onChange={(e) => setCurrency(e.target.value)} className="px-4 py-2 border border-gray-300 rounded-lg bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        {Object.entries(currencyConfig).map(([code, config]) => (<option key={code} value={code}>{config.symbol} {config.name} ({config.country})</option>))}
                    </select>
                </div>
                <PerspectiveToggle perspective={perspective} setPerspective={setPerspective} />
              </div>

              <div className="flex justify-center mb-6"><div className="flex flex-wrap justify-center space-x-1 bg-white p-1 rounded-lg border shadow-sm">{displayedTabs.map((tab) => {
                  const isResultTab = resultTabs.includes(tab);
                  const activeClass = isResultTab ? 'bg-green-600 text-white shadow' : 'bg-blue-600 text-white shadow';
                  const inactiveClass = 'text-gray-600 hover:bg-gray-100';
                  return (<button key={tab} onClick={() => setActiveTab(tab)} className={`px-4 py-2 text-sm sm:px-6 sm:py-2 rounded-md font-medium capitalize transition-colors duration-200 ${activeTab === tab ? activeClass : inactiveClass}`}>{tab}</button>);
              })}</div></div>
              
              {activeTab === 'financial' && (<div className="space-y-6"><Card><CardHeader><h4 className="font-semibold text-gray-800">Purpose of This Section</h4></CardHeader><CardContent><p className="text-sm text-gray-700">This section assesses your core financial capacity. It looks at your income (ability to earn) and your assets vs. debts (your net worth and stability). This is the foundation of your ability to handle credit.</p></CardContent></Card><div className="grid grid-cols-1 lg:grid-cols-2 gap-6"><Card><CardHeader><div className="flex items-center gap-2"><TrendingUp className="w-5 h-5 text-green-600" /><h3 className="text-lg font-semibold text-gray-800">Income & Assets</h3></div></CardHeader><CardContent className="space-y-6"><SliderInput label="Individual Annual Income" value={inputs.individualIncome} onChange={(val) => setInputs({...inputs, individualIncome: val})} min={10000} max={500000} step={1000} icon={User} isCurrency={true} helpText="Higher income demonstrates a stronger ability to repay debt." /><SliderInput label="Family Annual Income" value={inputs.familyIncome} onChange={(val) => setInputs({...inputs, familyIncome: val})} min={10000} max={800000} step={1000} icon={Users} isCurrency={true} helpText="Total household income provides a broader view of financial capacity." /><SliderInput label="Bank Savings" value={inputs.bankSavings} onChange={(val) => setInputs({...inputs, bankSavings: val})} min={0} max={200000} step={500} icon={DollarSign} isCurrency={true} helpText="Liquid savings are crucial for handling emergencies without borrowing." /><SliderInput label="Equity Investments" value={inputs.equityInvestments} onChange={(val) => setInputs({...inputs, equityInvestments: val})} min={0} max={500000} step={1000} icon={TrendingUp} isCurrency={true} helpText="Investments show financial planning but are less liquid than cash." /><SliderInput label="Real Estate Value" value={inputs.realEstate} onChange={(val) => setInputs({...inputs, realEstate: val})} min={0} max={2000000} step={10000} icon={Building} isCurrency={true} helpText="Property is a significant asset but is not liquid." /><SliderInput label="Bullion Assets" value={inputs.bullionAssets} onChange={(val) => setInputs({...inputs, bullionAssets: val})} min={0} max={100000} step={500} icon={PiggyBank} isCurrency={true} helpText="Valued at 90% due to liquidity. A stable, physical asset." /><SliderInput label="Cryptocurrency Assets" value={inputs.cryptoAssets} onChange={(val) => setInputs({...inputs, cryptoAssets: val})} min={0} max={100000} step={500} icon={AlertTriangle} isCurrency={true} helpText="Valued at 50% due to high volatility and risk." /></CardContent></Card><Card><CardHeader><div className="flex items-center gap-2"><CreditCard className="w-5 h-5 text-red-600" /><h3 className="text-lg font-semibold text-gray-800">Debts & Cash Flow</h3></div></CardHeader><CardContent className="space-y-6"><SliderInput label="Secured Debt" value={inputs.securedDebt} onChange={(val) => setInputs({...inputs, securedDebt: val})} min={0} max={800000} step={1000} icon={Shield} isCurrency={true} helpText="Debt backed by an asset, like a mortgage or auto loan." /><SliderInput label="Unsecured Debt" value={inputs.unsecuredDebt} onChange={(val) => setInputs({...inputs, unsecuredDebt: val})} min={0} max={100000} step={500} icon={CreditCard} isCurrency={true} helpText="Debt not backed by an asset, like credit cards or personal loans." /><SliderInput label="Avg. Monthly Income (Post-Tax)" value={inputs.avgMonthlyIncome} onChange={(val) => setInputs({...inputs, avgMonthlyIncome: val})} min={500} max={20000} step={100} icon={DollarSign} isCurrency={true} helpText="Your actual take-home pay, which determines your repayment ability." /><SliderInput label="Avg. Month-End Bank Balance" value={inputs.avgMonthEndBalance} onChange={(val) => setInputs({...inputs, avgMonthEndBalance: val})} min={0} max={50000} step={100} icon={Bank} isCurrency={true} helpText="A higher balance before your next paycheck indicates positive cash flow." /></CardContent></Card></div></div>)}
              {activeTab === 'payment history' && (<div className="space-y-6 max-w-4xl mx-auto"><Card><CardHeader><h4 className="font-semibold text-gray-800">Purpose of This Section</h4></CardHeader><CardContent><p className="text-sm text-gray-700">This is the most critical part of any credit model. It's a direct record of your reliability and answers the fundamental question for any lender: "Does this person pay their bills on time?"</p></CardContent></Card><Card><CardHeader><div className="flex items-center gap-2"><Shield className="w-5 h-5 text-blue-600" /><h3 className="text-lg font-semibold text-gray-800">Payment History (% On-Time)</h3></div></CardHeader><CardContent className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><SliderInput label="Credit Cards" value={inputs.creditCardPayments} onChange={(val) => setInputs({...inputs, creditCardPayments: val})} min={0} max={100} icon={CreditCard} unit="%" helpText="Most heavily weighted payment type." /><SliderInput label="Loans" value={inputs.loanPayments} onChange={(val) => setInputs({...inputs, loanPayments: val})} min={0} max={100} icon={DollarSign} unit="%" helpText="Includes personal, auto, and student loans." /><SliderInput label="Rent/Mortgage" value={inputs.rentPayments} onChange={(val) => setInputs({...inputs, rentPayments: val})} min={0} max={100} icon={Building} unit="%" helpText="Consistent housing payments are a strong stability signal." /><SliderInput label="Utility Payments" value={inputs.utilityPayments} onChange={(val) => setInputs({...inputs, utilityPayments: val})} min={0} max={100} icon={Info} unit="%" helpText="Electricity, water, gas, phone bills." /><SliderInput label="Taxes" value={inputs.governmentPayments} onChange={(val) => setInputs({...inputs, governmentPayments: val})} min={0} max={100} icon={Shield} unit="%" helpText="Timely tax payments are a key responsibility." /></CardContent></Card></div>)}
              {activeTab === 'lifestyle' && (<div className="space-y-6"><Card><CardHeader><h4 className="font-semibold text-gray-800">Purpose of This Section</h4></CardHeader><CardContent><p className="text-sm text-gray-700">The spending information in this section is <strong className="text-blue-600">not</strong> used to judge your creditworthiness or calculate your risk score. It is only used to estimate your monthly expenses, which helps provide a personalized target for your 3-to-6-month emergency fund in the final report.</p></CardContent></Card><div className="grid grid-cols-1 lg:grid-cols-3 gap-6"><Card><CardHeader><h3 className="text-lg font-semibold text-gray-800">Family & Essentials</h3></CardHeader><CardContent className="space-y-6"><SliderInput label="Monthly Groceries" value={inputs.groceriesSpending} onChange={(val) => setInputs({...inputs, groceriesSpending: val})} min={0} max={2000} step={25} icon={ShoppingCart} isCurrency={true} /><SliderInput label="Kids' Education" value={inputs.kidsEducationSpending} onChange={(val) => setInputs({...inputs, kidsEducationSpending: val})} min={0} max={3000} step={50} icon={GraduationCap} isCurrency={true} /><SliderInput label="Clothing & Apparel" value={inputs.clothingSpending} onChange={(val) => setInputs({...inputs, clothingSpending: val})} min={0} max={1000} step={20} icon={Shirt} isCurrency={true} /><SliderInput label="Kids' Activities" value={inputs.kidsActivitiesSpending} onChange={(val) => setInputs({...inputs, kidsActivitiesSpending: val})} min={0} max={1000} step={20} icon={Activity} isCurrency={true} /></CardContent></Card><Card><CardHeader><h3 className="text-lg font-semibold text-gray-800">Insurance & Transport</h3></CardHeader><CardContent className="space-y-6"><SliderInput label="Car Maintenance/Petrol" value={inputs.carMaintenance} onChange={(val) => setInputs({...inputs, carMaintenance: val})} min={0} max={1000} step={20} icon={Car} isCurrency={true} /><SliderInput label="Life Insurance" value={inputs.lifeInsurance} onChange={(val) => setInputs({...inputs, lifeInsurance: val})} min={0} max={1000} step={10} icon={Shield} isCurrency={true} /><SliderInput label="Medical Insurance" value={inputs.medicalInsurance} onChange={(val) => setInputs({...inputs, medicalInsurance: val})} min={0} max={2000} step={25} icon={HeartPulse} isCurrency={true} /><SliderInput label="Medical Bills (Out of Pocket)" value={inputs.medicalBills} onChange={(val) => setInputs({...inputs, medicalBills: val})} min={0} max={1000} step={10} icon={HeartPulse} isCurrency={true} /></CardContent></Card><Card><CardHeader><h3 className="text-lg font-semibold text-gray-800">Discretionary Spending</h3></CardHeader><CardContent className="space-y-6"><SliderInput label="Dining & Delivery" value={inputs.restaurantSpending} onChange={(val) => setInputs({...inputs, restaurantSpending: val})} min={0} max={2000} step={25} icon={DollarSign} isCurrency={true} /><SliderInput label="Subscriptions" value={inputs.subscriptionServices} onChange={(val) => setInputs({...inputs, subscriptionServices: val})} min={0} max={500} step={10} icon={CreditCard} isCurrency={true} /><SliderInput label="Vacation & Travel" value={inputs.vacationSpending} onChange={(val) => setInputs({...inputs, vacationSpending: val})} min={0} max={20000} step={250} icon={Globe} isCurrency={true} /><SliderInput label="'Sin' Spending" value={inputs.sinSpending} onChange={(val) => setInputs({...inputs, sinSpending: val})} min={0} max={1000} step={10} icon={AlertTriangle} isCurrency={true} helpText="Gambling, tobacco, alcohol, etc." /><SliderInput label="Donations" value={inputs.donations} onChange={(val) => setInputs({...inputs, donations: val})} min={0} max={1000} step={10} icon={HeartPulse} isCurrency={true} /><SliderInput label="Other Expenses" value={inputs.otherExpenses} onChange={(val) => setInputs({...inputs, otherExpenses: val})} min={0} max={2000} step={25} icon={Info} isCurrency={true} /></CardContent></Card></div></div>)}
              {activeTab === 'behavioral' && (<div className="space-y-6 max-w-4xl mx-auto"><Card><CardHeader><h4 className="font-semibold text-gray-800">Purpose of This Section</h4></CardHeader><CardContent><p className="text-sm text-gray-700">This section acts as a proxy for your financial habits and planning. Using budgeting tools and having clear goals are strong behavioral indicators of a responsible and proactive borrower.</p></CardContent></Card><Card><CardHeader><h3 className="text-lg font-semibold text-gray-800">Financial Habits & Planning</h3></CardHeader><CardContent className="space-y-6"><RadioGroup label="Budgeting Tools Sophistication" options={['No formal budget', 'I use a spreadsheet', 'I use a budgeting app (Mint, YNAB, etc.)', 'I use advanced software (e.g., for business)', 'I work with a financial advisor']} value={inputs.budgetingTool} onChange={(val) => setInputs({...inputs, budgetingTool: val})} icon={Calculator} helpText="Using budgeting tools is a positive behavioral signal that you proactively manage your finances." /><CheckboxGroup label="What are your primary financial goals?" options={{ retirement: 'Saving for retirement', emergencyFund: 'Building an emergency fund', downPayment: 'Saving for a down payment', payOffDebt: 'Paying off debt', travel: 'Saving for travel/large purchase' }} values={inputs.financialGoals} onChange={(key) => setInputs({...inputs, financialGoals: {...inputs.financialGoals, [key]: !inputs.financialGoals[key]}})} icon={Target} helpText="Having clear financial goals is another positive signal of financial planning and stability." /></CardContent></Card></div>)}
              {activeTab === 'demographics' && (<div className="space-y-6 max-w-4xl mx-auto"><Card><CardHeader><h4 className="font-semibold text-gray-800">Purpose of This Section</h4></CardHeader><CardContent><p className="text-sm text-gray-700">These factors provide context about your stability. Lenders use this information to build a broader picture of your financial responsibilities. Longer employment tenure and a stable residency status suggest a lower risk of sudden income loss.</p></CardContent></Card><Card><CardHeader><h3 className="text-lg font-semibold text-gray-800">Personal & Employment</h3></CardHeader><CardContent className="space-y-6"><SliderInput label="Age" value={inputs.age} onChange={(val) => setInputs({...inputs, age: val})} min={18} max={80} icon={User} unit=" years" helpText="Age can be a proxy for the length of your credit history and financial experience." /><SliderInput label="Employment Tenure" value={inputs.employmentTenure} onChange={(val) => setInputs({...inputs, employmentTenure: val})} min={0} max={120} icon={User} unit=" months" helpText="Months at current job. Longer tenure indicates income stability." /><SliderInput label="Number of Children" value={inputs.numberOfChildren} onChange={(val) => setInputs({...inputs, numberOfChildren: val})} min={0} max={8} icon={Users} unit=" children" /><RadioGroup label="Marital Status" options={['Single', 'Married/Partner']} value={inputs.marriedStatus} onChange={(val) => setInputs({...inputs, marriedStatus: val})} icon={Users} helpText="These demographic factors help build a broader picture of financial responsibilities and stability." /><RadioGroup label="Education Level" options={['High School', 'Some College', 'Bachelors', 'Masters', 'PhD/Professional']} value={inputs.educationLevel} onChange={(val) => setInputs({...inputs, educationLevel: val})} icon={User} helpText="Often correlates with income stability and financial literacy." /><RadioGroup label="Residency Status" options={['Citizen', 'Permanent Resident', 'Long-Term Work Permit', 'Other/Short-Term Visa']} value={inputs.residencyStatus} onChange={(val) => setInputs({...inputs, residencyStatus: val})} icon={Globe} helpText="Citizenship or permanent residency indicates long-term stability in the country, reducing risk." /></CardContent></Card></div>)}

              {inputTabs.includes(activeTab) && (<div className="flex justify-center my-8"><button onClick={handleCalculateRisk} className="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-transform transform hover:scale-105 shadow-lg flex items-center gap-2"><Calculator className="w-5 h-5" />Calculate Risk Assessment</button></div>)}

              {hasCalculated && activeTab === 'results' && (
                <div>
                    {perspective === 'borrower' && (
                        <div className="space-y-6">
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <Card className="lg:col-span-1"><CardHeader><h3 className="text-lg font-semibold text-gray-800">Your Financial Health Score</h3></CardHeader><CardContent className="space-y-4"><div className="text-center p-6 bg-gray-100 rounded-lg"><div className="text-5xl font-bold mb-2 text-gray-800">{results.overallRiskScore}</div><div className={`text-lg font-semibold mb-1 ${results.overallRiskScore >= 75 ? 'text-green-600' : results.overallRiskScore >= 55 ? 'text-yellow-600' : 'text-red-600'}`}>{results.riskCategory}</div><div className="text-sm text-gray-600">Grade: {results.riskGrade}</div></div></CardContent></Card>
                                <Card className="lg:col-span-2"><CardHeader><h3 className="text-lg font-semibold text-gray-800">Peer Comparison</h3></CardHeader><CardContent><p className="text-sm text-gray-600 mb-2">This chart shows your score relative to a typical population distribution. This is a simulation and not based on live user data.</p><BellCurveChart userScore={results.overallRiskScore} /></CardContent></Card>
                            </div>
                            <ScoreGuide />
                            <LoanScenarios results={results} inputs={inputs} currencyConfig={currencyConfig} currency={currency} formatCurrency={formatCurrency} />
                            <ModelAssumptions />
                            <Card><CardHeader><div className="flex items-center gap-2"><FileText className="w-5 h-5 text-gray-700" /><h3 className="text-lg font-semibold text-gray-800">Credit Improvement Report</h3></div></CardHeader><CardContent><div className="text-sm text-gray-700 whitespace-pre-wrap" dangerouslySetInnerHTML={{ __html: improvementReport.replace(/\*\s(.*?)\n/g, '<li class="flex items-start gap-2 mb-2"><span class="mt-1 text-green-500">✔</span><span>$1</span></li>').replace(/<li>/g, '<ul class="list-none p-0"><li>') + '</ul>' }}></div></CardContent></Card>
                        </div>
                    )}
                    {perspective === 'lender' && (
                        <div className="space-y-6">
                             <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <Card className="lg:col-span-1"><CardHeader><h3 className="text-lg font-semibold text-gray-800">Risk Assessment Summary</h3></CardHeader><CardContent className="space-y-4"><div className="text-center p-6 bg-gray-100 rounded-lg"><div className="text-5xl font-bold mb-2 text-gray-800">{results.overallRiskScore}</div><div className={`text-lg font-semibold mb-1 ${results.overallRiskScore >= 75 ? 'text-green-600' : results.overallRiskScore >= 55 ? 'text-yellow-600' : 'text-red-600'}`}>{results.riskCategory}</div><div className="text-sm text-gray-600">Grade: {results.riskGrade}</div><div className="text-xs text-gray-500 mt-2">{currencyConfig[currency].score_equiv_label}: <strong className="text-gray-700">{currencyConfig[currency].get_score(results.overallRiskScore)}</strong></div></div>
                                    <div className="space-y-3 pt-2">
                                        <div><h4 className="font-semibold text-sm text-gray-600">Recommended Unsecured Credit Limit:</h4><div className="text-2xl font-bold text-blue-600">{formatCurrency(results.recommendedLimit)}</div></div>
                                        <div><h4 className="font-semibold text-sm text-gray-600">Expected Loss:</h4><div className="text-lg font-bold text-red-600">{formatCurrency(results.expectedLoss)}</div></div>
                                    </div>
                                </CardContent></Card>
                                <Card className="lg:col-span-2"><CardHeader><h3 className="text-lg font-semibold text-gray-800">Key Risk Metrics</h3></CardHeader><CardContent>
                                    {calculationBreakdown && <AdvancedMetricsStep data={calculationBreakdown.advancedMetrics} />}
                                </CardContent></Card>
                            </div>
                            <Card>
                                <CardHeader><h3 className="text-lg font-semibold text-gray-800">Applicant Financial Ratios</h3></CardHeader>
                                <CardContent className="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                                    <div className="p-4 bg-gray-50 rounded-lg">
                                        <div className="text-sm text-gray-500">Debt-to-Income Ratio</div>
                                        <div className={`text-2xl font-bold ${results.debtToIncomeRatio > 40 ? 'text-red-600' : 'text-green-600'}`}>{results.debtToIncomeRatio}%</div>
                                    </div>
                                    <div className="p-4 bg-gray-50 rounded-lg">
                                        <div className="text-sm text-gray-500">Leverage Ratio</div>
                                        <div className={`text-2xl font-bold ${results.leverageRatio > 50 ? 'text-yellow-600' : 'text-green-600'}`}>{results.leverageRatio}%</div>
                                    </div>
                                     <div className="p-4 bg-gray-50 rounded-lg">
                                        <div className="text-sm text-gray-500">Warning Flags</div>
                                        <div className="text-lg font-bold text-red-600">{results.warningFlags.length > 0 ? results.warningFlags.join(', ') : 'None'}</div>
                                    </div>
                                </CardContent>
                            </Card>
                        </div>
                    )}
                </div>
              )}
              {hasCalculated && activeTab === 'model logic' && (<div className="space-y-4">
                  <DetailedCalculationStep data={calculationBreakdown.paymentHistory} />
                  <DetailedCalculationStep data={calculationBreakdown.financialHealth} />
                  <DetailedCalculationStep data={calculationBreakdown.behavioral} />
                  <DetailedCalculationStep data={calculationBreakdown.finalScore} />
              </div>)}
              
              <div className="mt-8 p-4 border-t-4 border-yellow-400 bg-yellow-50 rounded-lg text-center">
                <div className="flex justify-center items-center gap-2">
                    <AlertTriangle className="w-6 h-6 text-yellow-600" />
                    <h3 className="text-lg font-semibold text-yellow-800">Important Disclaimer</h3>
                </div>
                <p className="text-sm text-yellow-700 mt-2 max-w-3xl mx-auto">
                  This platform is for educational and illustrative purposes only. The score generated is based on a transparent, generalized model and is **not** an official credit score. It does not constitute financial, investment, or credit advice. The calculations are not affiliated with, endorsed by, or connected to any official credit rating agency like SCHUFA, CRISIL, Experian, Equifax, or TransUnion. The peer comparison chart is a simulation based on publicly available statistical data from sources including **Experian (USA)**, **SCHUFA (Germany)**, and analyses of **CIBIL score ranges (India)**. Always consult with a qualified financial professional and refer to your official credit report for actual lending decisions.
                </p>
              </div>
              <footer className="text-center mt-8 text-sm text-gray-500">
                <p>Copyright 2025 <a href="https://arnavray.ca" target="_blank" className="text-blue-600 hover:underline">Arnav Amal Ray</a></p>
              </footer>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>

</body>
</html>
